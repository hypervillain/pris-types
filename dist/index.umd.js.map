{"version":3,"file":"index.umd.js","sources":["../src/types.js","../src/index.js"],"sourcesContent":["const _handleFields = (fields = {}) => {\n  return Object.entries(fields).reduce((acc, [key, fn]) => {\n    const depth = fn.toString().split('=>').length - 1\n    return {\n      ...acc,\n      [key]: depth > 1 ? fn({})(key) : fn(key)\n    }\n  }, {})\n}\n\nconst variation = (zones) => {\n  const { primary, items } = zones\n\n  return {\n    primary: _handleFields(primary),\n    items: _handleFields(items),\n  } \n}\n\nconst shape = (obj) => {\n  const { __common = {}, ...variations } = obj\n  return {\n    title: 'My Slice',\n    description: 'Hi!',\n    variations: Object.entries(variations).reduce((acc, [key, variation]) => {\n      return [\n        ...acc,\n        {\n          id: key,\n          ...variation,\n          primary: {\n            ...variation.primary,\n            ..._handleFields(__common.primary)\n          },\n          items: {\n            ...variation.items,\n            ..._handleFields(__common.items)\n\n          }\n        }\n      ]\n    }, [])\n  }\n}\n\nconst ALL_OPTIONS = ['paragraph', '...']\n\nconst RichText = ({ placeholder, multi = false, options = ALL_OPTIONS }) => (fieldName) => ({\n  type: 'StructuredText',\n  config: {\n    [multi ? 'multi' : 'single']: options.join(','),\n    placeholder: placeholder || `${fieldName} field`\n  }\n})\n\nconst Title = (params) => (fieldName) => RichText({ ...params, options: ['heading1', 'heading2' ]})(fieldName)\n\nconst Color = ({ placeholder }) => (fieldName) => ({\n  type: 'Color',\n  config: {\n    placeholder: placeholder || `${fieldName} field`\n  }\n})\n\nconst Types = {\n  shape,\n  variation,\n  RichText,\n  Title,\n  Color\n}\n\nexport {\n  Types\n}\n","// import fs from 'fs'\nimport generate from '@babel/generator'\nimport extract from 'babel-extract-named-export'\n\nimport { Types } from './types'\n\n// const file = fs.readFileSync('./ExampleSlice/index.js', 'utf-8')\n\nfunction validate(Model) {\n  if (!Model || !Model.type || Model.type !== 'CallExpression') {\n    return false\n  }\n  return true\n}\n\nfunction createEval(node, build) {\n  const { code } = generate(node)\n  const req = `pris-types/dist/index.${build ? `${build}.` : ''}js`\n  const str = `\n    var dir = \"${__dirname}\"\n    const PrisTypes = require(\"${req}\").PrisTypes;\n    return ${code}\n  `;\n  return str\n}\n\nconst extractor = async (code) => {\n  const { Model } = await extract(code, { search: ['Model'], fallback: true })\n  if (!validate(Model)) {\n    return { err: true }\n  }\n  return { Model }\n}\n\nconst evaluator = (Model, { build = '' } = { build: '' }) => {\n  const code = createEval(Model, build)\n  const slice = eval('(function() {' + code + '}())')\n  return slice\n}\n\nasync function main() {\n  const { Model, err } = extractor(file)\n  return evaluator(Model)\n}\n\nexport {\n  evaluator,\n  extractor,\n  Types as PrisTypes\n}\n"],"names":["_handleFields","fields","Object","entries","reduce","acc","key","fn","depth","toString","split","length","variation","zones","primary","items","shape","obj","__common","variations","title","description","id","ALL_OPTIONS","RichText","placeholder","multi","options","fieldName","type","config","join","Title","params","Color","Types","validate","Model","createEval","node","build","code","generate","req","str","__dirname","extractor","extract","search","fallback","err","evaluator","slice","eval"],"mappings":"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"}