{"version":3,"file":"index.modern.js","sources":["../src/types.js","../src/index.js"],"sourcesContent":["const _handleFields = (fields = {}) => {\n  return Object.entries(fields).reduce((acc, [key, fn]) => {\n    const depth = fn.toString().split('=>').length - 1\n    return {\n      ...acc,\n      [key]: depth > 1 ? fn({})(key) : fn(key)\n    }\n  }, {})\n}\n\nconst variation = (zones) => {\n  const { primary, items } = zones\n\n  return {\n    primary: _handleFields(primary),\n    items: _handleFields(items),\n  } \n}\n\nconst shape = (obj) => {\n  const { __common = {}, ...variations } = obj\n  return {\n    title: 'My Slice',\n    description: 'Hi!',\n    variations: Object.entries(variations).reduce((acc, [key, variation]) => {\n      return [\n        ...acc,\n        {\n          id: key,\n          ...variation,\n          primary: {\n            ...variation.primary,\n            ..._handleFields(__common.primary)\n          },\n          items: {\n            ...variation.items,\n            ..._handleFields(__common.items)\n\n          }\n        }\n      ]\n    }, [])\n  }\n}\n\nconst ALL_OPTIONS = ['paragraph', '...']\n\nconst RichText = ({ placeholder, multi = false, options = ALL_OPTIONS }) => (fieldName) => ({\n  type: 'StructuredText',\n  config: {\n    [multi ? 'multi' : 'single']: options.join(','),\n    placeholder: placeholder || `${fieldName} field`\n  }\n})\n\nconst Title = (params) => (fieldName) => RichText({ ...params, options: ['heading1', 'heading2' ]})(fieldName)\n\nconst Color = ({ placeholder }) => (fieldName) => ({\n  type: 'Color',\n  config: {\n    placeholder: placeholder || `${fieldName} field`\n  }\n})\n\nconst Types = {\n  shape,\n  variation,\n  RichText,\n  Title,\n  Color\n}\n\nexport {\n  Types\n}\n","// import fs from 'fs'\nimport generate from '@babel/generator'\nimport extract from 'babel-extract-named-export'\n\nimport { Types } from './types'\n\n// const file = fs.readFileSync('./ExampleSlice/index.js', 'utf-8')\n\nfunction validate(Model) {\n  if (!Model || !Model.type || Model.type !== 'CallExpression') {\n    return false\n  }\n  return true\n}\n\nfunction createEval(node, build) {\n  const { code } = generate(node)\n  const req = `pris-types/dist/index.${build ? `${build}.` : ''}js`\n  const str = `\n    var dir = \"${__dirname}\"\n    const PrisTypes = require(\"${req}\").PrisTypes;\n    return ${code}\n  `;\n  return str\n}\n\nconst extractor = async (code) => {\n  const { Model } = await extract(code, { search: ['Model'], fallback: true })\n  if (!validate(Model)) {\n    return { err: true }\n  }\n  return { Model }\n}\n\nconst evaluator = (Model, { build = '' } = { build: '' }) => {\n  const code = createEval(Model, build)\n  const slice = eval('(function() {' + code + '}())')\n  return slice\n}\n\nasync function main() {\n  const { Model, err } = extractor(file)\n  return evaluator(Model)\n}\n\nexport {\n  evaluator,\n  extractor,\n  Types as PrisTypes\n}\n"],"names":["_handleFields","fields","Object","entries","reduce","acc","key","fn","depth","toString","split","length","variation","zones","primary","items","shape","obj","__common","variations","title","description","id","ALL_OPTIONS","RichText","placeholder","multi","options","fieldName","type","config","join","Title","params","Color","Types","validate","Model","createEval","node","build","code","generate","req","str","__dirname","extractor","extract","search","fallback","err","evaluator","slice","eval"],"mappings":"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"}